{% extends "base.html" %}
{% block content %}

<div class="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 
            flex items-center justify-center px-4 py-6">

  <!-- MAIN CARD -->
  <div class="w-full max-w-6xl bg-white rounded-2xl shadow-2xl overflow-hidden
              grid grid-cols-1 lg:grid-cols-2">

    <!-- LEFT IMAGE / INFO -->
    <div class="hidden lg:flex flex-col justify-between p-10 text-white
                bg-cover bg-center"
         style="background-image: url('https://images.unsplash.com/photo-1521737604893-d14cc237f11d');">

      <div class="bg-black/40 p-6 rounded-xl">
        <h2 class="text-3xl font-bold mb-3">AI Resume Builder</h2>
        <p class="text-sm">
          Create a professional, ATS-friendly resume with smart AI suggestions.
        </p>
      </div>

      <div class="bg-black/40 p-4 rounded-xl text-sm">
        ✔ LinkedIn-style editing<br>
        ✔ AI suggestions<br>
        ✔ Mobile & desktop friendly
      </div>
    </div>

    <!-- RIGHT FORM -->
    <div class="p-6 sm:p-10 max-h-[90vh] overflow-y-auto">

      <h3 class="text-2xl font-bold mb-6 text-gray-800">
        Create Your Resume
      </h3>

      <form method="POST" class="space-y-7">
        {% csrf_token %}

        <!-- BASIC INFO -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
          <input name="full_name" required placeholder="Full Name"
            class="w-full p-3 border rounded-lg">

          <input name="email" type="email" required placeholder="Email"
            class="w-full p-3 border rounded-lg">

          <input name="phone" placeholder="Phone"
            class="w-full p-3 border rounded-lg">
        </div>

        <!-- SUMMARY -->
        <div>
          <div class="flex justify-between items-center mb-1">
            <label class="font-semibold text-gray-700">Professional Summary</label>
            <button type="button"
              onclick="aiImprove('summary')"
              class="text-xs px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg">
              ✨ AI Generate
            </button>
          </div>

          <textarea id="summary" name="summary" rows="4"
            class="w-full p-3 border rounded-lg"
            placeholder="Write or leave empty for AI"></textarea>

          <textarea id="summary_ai"
            class="hidden w-full mt-3 p-3 border rounded-lg bg-gray-50"></textarea>
        </div>

        <!-- SKILLS -->
        <div>
          <div class="flex justify-between items-center mb-1">
            <label class="font-semibold text-gray-700">Skills</label>
            <button type="button"
              onclick="aiImprove('skills')"
              class="text-xs px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg">
              ✨ AI Suggest
            </button>
          </div>

          <textarea id="skills" name="skills" rows="3"
            class="w-full p-3 border rounded-lg"
            placeholder="Python, Django, SQL..."></textarea>

          <textarea id="skills_ai"
            class="hidden w-full mt-3 p-3 border rounded-lg bg-gray-50"></textarea>
        </div>

        <!-- EXPERIENCE -->
        <div>
          <div class="flex justify-between items-center mb-1">
            <label class="font-semibold text-gray-700">Experience</label>
            <button type="button"
              onclick="aiImprove('experience')"
              class="text-xs px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg">
              ✨ AI Write
            </button>
          </div>

          <textarea id="experience" name="experience" rows="4"
            class="w-full p-3 border rounded-lg"
            placeholder="Describe your experience"></textarea>

          <textarea id="experience_ai"
            class="hidden w-full mt-3 p-3 border rounded-lg bg-gray-50"></textarea>
        </div>

        <!-- EDUCATION -->
        <div>
          <label class="font-semibold text-gray-700">Education</label>
          <textarea name="education" rows="3"
            class="w-full p-3 border rounded-lg"
            placeholder="Degree, College, Year"></textarea>
        </div>

        <!-- ACTIONS -->
        <div class="flex gap-4 pt-4">
          <button type="submit"
            class="px-8 py-3 bg-indigo-600 text-white rounded-lg">
            Save Resume
          </button>

          <a href="/dashboard/"
            class="px-8 py-3 bg-gray-200 rounded-lg text-center">
            Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ===================== -->
<!-- ✅ AI JAVASCRIPT -->
<!-- ===================== -->
<script>
function aiImprove(field) {
    improveText(field, field + "_ai");
}

async function improveText(sourceId, targetId) {
    const sourceEl = document.getElementById(sourceId);
    const targetEl = document.getElementById(targetId);

    const text = sourceEl.value.trim();
    if (!text) {
        alert("Please enter some text first.");
        return;
    }

    targetEl.classList.remove("hidden");
    targetEl.value = "⏳ Improving with AI...";

    try {
        const response = await fetch("/ai/improve/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({ text })
        });

        const data = await response.json();
        console.log("AI RESPONSE:", data);

        if (!response.ok) {
            targetEl.value = "";
            alert(data.error || "AI error");
            return;
        }

        if (data.result) {
            targetEl.value = data.result;
        } else {
            targetEl.value = "";
            alert("AI returned empty result");
        }

    } catch (err) {
        targetEl.value = "";
        alert("Network error");
        console.error(err);
    }
}
</script>

{% endblock %}
